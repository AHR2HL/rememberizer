{% extends "base.html" %}

{% block title %}My Domains{% endblock %}

{% block header_title %}{{ "MY DOMAINS" | center_in_box }}{% endblock %}

{% block content %}
<div class="content">
    {% if streak_info %}
    <div class="streak-banner">
        <span class="streak-label">&gt; STREAK:</span>
        <span class="streak-count">{{ streak_info.current_streak }}</span>
        <span class="streak-unit">{% if streak_info.current_streak == 1 %}DAY{% else %}DAYS{% endif %}</span>
        {% if streak_info.streak_at_risk %}
        <br><span class="streak-warning">[!] Practice today to keep your streak</span>
        {% endif %}
    </div>

    <div class="daily-goal-progress">
        <span>&gt; TODAY: {{ streak_info.questions_today }}/{{ streak_info.daily_goal }} questions</span>
        {% if streak_info.goal_completed %}
        <span style="color: #00FF00;"> [GOAL MET]</span>
        {% endif %}
        <br>
        <span class="progress-ascii">[{{ '=' * (streak_info.goal_percentage // 10) }}{{ '-' * (10 - streak_info.goal_percentage // 10) }}]</span>
    </div>
    {% endif %}

    <h2>&gt; YOUR ASSIGNED DOMAINS</h2>

    {% if domain_data|length == 0 %}
        <div class="info-box">
            <p>You don't have any domains assigned yet.</p>
            <p>Please contact your teacher to get started.</p>
        </div>
    {% else %}
        <div class="domain-list">
            {% for data in domain_data %}
            <div class="domain-item">
                <form method="POST" action="{{ url_for('quiz.start') }}" class="domain-form">
                    <input type="hidden" name="domain_id" value="{{ data.domain.id }}">
                    <button type="submit" class="domain-button">
                        <strong>{{ data.domain.name }}</strong>
                        {% if data.progress.is_complete %}
                        <span style="color: #00FF00;"> [COMPLETED]</span>
                        {% endif %}
                        <br>
                        Progress: {{ data.progress.progress_string }}
                        <br>
                        Learned: {{ data.progress.learned_count }}/{{ data.progress.total_facts }} |
                        Mastered: {{ data.progress.mastered_count }}/{{ data.progress.total_facts }}
                        {% if data.progress.attempt_count > 0 %}
                        <br>
                        Questions Answered: {{ data.progress.attempt_count }}
                        {% endif %}
                    </button>
                </form>
                {% if data.progress.attempt_count > 0 %}
                <form method="POST" action="{{ url_for('quiz.reset_domain_from_menu', domain_id=data.domain.id) }}"
                      class="reset-form" onsubmit="return confirm('Reset all your progress for this domain?');">
                    <button type="submit" class="reset-button">[RESET]</button>
                </form>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    {% endif %}


    <div class="button-container">
        <a href="{{ url_for('student.progress') }}" class="action-button">[VIEW DETAILED PROGRESS]</a>
    </div>
</div>
{% endblock %}

{% block footer_text %}Select a domain to start practicing{% endblock %}
